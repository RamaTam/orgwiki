<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ch" xml:lang="ch">
<head>
<title>使用三角形批次类构建更多对象</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="使用三角形批次类构建更多对象"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2012-10-18 14:49:09 CST"/>
<meta name="author" content="Joseph Pan"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style><link rel="stylesheet" href="./other/style.css" type="text/css"/>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>
<div id="org-div-home-and-up" style="text-align:right;font-size:70%;white-space:nowrap;">
 <a accesskey="h" href="./opengl_index.html"> UP </a>
 |
 <a accesskey="H" href="./index.html"> HOME </a>
</div>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">使用三角形批次类构建更多对象</h1>



<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 使用三角形批次类</a></li>
<li><a href="#sec-2">2 示例程序</a></li>
<li><a href="#sec-3">3 创建一个球体</a></li>
<li><a href="#sec-4">4 创建一个花托</a></li>
<li><a href="#sec-5">5 创建一个圆柱或圆锥</a></li>
<li><a href="#sec-6">6 创建一个圆盘</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 使用三角形批次类</h2>
<div class="outline-text-2" id="text-1">



<p>
   GLTriangleBatch类是专门作为三角形的批次容器的，每个顶点都可以有一个表面法线，以进行光照计算和纹理坐标。
</p>
<p>   
   建立自己的三角形批次对象是一件非常简单的事。
</p>
<p>
   首先，我们需要为对象创建一个事件。
</p>



<pre class="src src-c"><span style="color: #00ffff; font-weight: bold;">GLTriangleBatch</span> <span style="color: #ffd700; font-style: italic;">myCoolObject</span>;
</pre>


<p>
   然后通知容器最多打算使用的顶点数，以开始创建网格。
</p>



<pre class="src src-c">myCoolObject.BeginMesh(200); <span style="color: #ffd700;">// </span><span style="color: #ffd700;">200 verts in my cool object.</span>
</pre>


<p>
   现在来添加三角形。 <code>AddTriangle</code> 成员函数接受一个包含3个顶点的数组，一个包含3个法线的数组，以及一个包含3个纹理坐标的数组。
</p>



<pre class="src src-c"><span style="color: #00ffff; font-weight: bold;">void</span> <span style="color: #ffd700; font-weight: bold;">GLTriangleBatch</span>::AddTriangle(<span style="color: #00ffff; font-weight: bold;">M3DVector3f</span> <span style="color: #ffd700; font-style: italic;">verts</span>[3], <span style="color: #00ffff; font-weight: bold;">M3DVector3f</span> <span style="color: #ffd700; font-style: italic;">vNorms</span>[3],
                                  <span style="color: #00ffff; font-weight: bold;">M3DVector3f</span> <span style="color: #ffd700; font-style: italic;">vTexCoords</span>[3])
</pre>


<p>
   不要担心会出现重复的顶点数据（读者可能会认为三角形带或三角形扇效率会更高）。在我们每一次添加一个顶点时， <code>GLTriangleBatch</code> 类都会搜索重复值并对我们的批次进行优化。实际上，对于非常大的批次来说，我们可能会发现这种操作在每次添加一个新三角形时都会越来越明显地降低速度。
</p>
<p>
   当我们添加完三角形时，调用End。
</p>



<pre class="src src-c">myCoolObject.End();
</pre>


<p>
   现在，我们只要选择想要的存储着色器并调用Draw函数。
</p>



<pre class="src src-c">myCoolObject.Draw();
</pre>


<p>
   库包含很多实用函数，它们可以将一个对象填充到一个 <code>GLTriangleBatch</code> 类中。示例程序 Objects 随着按下空格键而重复进行这个过程。
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> 示例程序</h2>
<div class="outline-text-2" id="text-2">


<ul>
<li><a href="program/opengl/Src/Chapter04/Objects/Objects.cpp">Objects.cpp</a>
</li>
</ul>


<p>
CANNOT INCLUDE FILE ./program/opengl/Src/Chapter04/Objects/Objects.cpp
</p>
<ul>
<li><a href="program/opengl/Linux/Chapter04/Objects/Makefile">Makefile</a>
</li>
</ul>


</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> 创建一个球体</h2>
<div class="outline-text-2" id="text-3">

<p>   <code>gltMakeSphere</code> 函数引用一个三角形批次、球的半径和组成球体的片段及其堆叠数量。
</p>



<pre class="src src-c"><span style="color: #00ffff; font-weight: bold;">void</span> <span style="color: #ffd700; font-weight: bold;">gltMakeSphere</span>(GLTriangleBatch&amp; sphereBatch, <span style="color: #00ffff; font-weight: bold;">GLfloat</span> <span style="color: #ffd700; font-style: italic;">fRadius</span>, <span style="color: #00ffff; font-weight: bold;">GLint</span> <span style="color: #ffd700; font-style: italic;">iSlices</span>, <span style="color: #00ffff; font-weight: bold;">GLint</span> <span style="color: #ffd700; font-style: italic;">iStacks</span>);
</pre>



<div class="figure">
<p><img src="./images/opengl_fig12.png"  alt="./images/opengl_fig12.png" /></p>
<p>一个球体</p>
</div>

<p>
   iSlices 参数和 iStacks 参数需要进行一点解释。我们可以将球体想像成围绕成球形的一系列三角形带。参数 iStacks 是这些从球体底部堆叠到顶部的三角形的数量。而 iSlices 参数则是围绕着球体排列的三角形对数。典型情况下一个对称性较好的球体的片段数量是堆叠数量的2倍，这是因为围绕球体一周是360°，而从底部到顶部只有180°（360°的一半）。另外需要注意的一点是，这些球体都是围绕z轴的，这样+z就是球体的顶点，而-z则是球体的底。
</p>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> 创建一个花托</h2>
<div class="outline-text-2" id="text-4">


<p>
   花托是一种环状的像面包圈一样的物体。用来创建花托的GLTools函数是 <code>gltMakeTorus</code> 。
</p>



<pre class="src src-c"><span style="color: #00ffff; font-weight: bold;">void</span> <span style="color: #ffd700; font-weight: bold;">gltMakeTorus</span>(GLTriangleBatch&amp; torusBatch, <span style="color: #00ffff; font-weight: bold;">GLfloat</span> <span style="color: #ffd700; font-style: italic;">majorRadius</span>, <span style="color: #00ffff; font-weight: bold;">GLint</span> <span style="color: #ffd700; font-style: italic;">minorRadius</span>, <span style="color: #00ffff; font-weight: bold;">GLint</span> <span style="color: #ffd700; font-style: italic;">numMajor</span>, <span style="color: #00ffff; font-weight: bold;">GLint</span> <span style="color: #ffd700; font-style: italic;">numMinor</span>);
</pre>


<p>
   其中 numMajor 和 numMinor参数的作用与球体中的 iSlices 和 iStacks 参数类似，它们是沿着主半径和内部较小半径的细分单元的数量。
</p>

<div class="figure">
<p><img src="./images/opengl_fig13.png"  alt="./images/opengl_fig13.png" /></p>
<p>一个花托</p>
</div>

</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> 创建一个圆柱或圆锥</h2>
<div class="outline-text-2" id="text-5">



<p>   
   <code>gltMakeCylinder</code> 函数可以创建一个空心圆柱体。
</p>



<pre class="src src-c"><span style="color: #00ffff; font-weight: bold;">void</span> <span style="color: #ffd700; font-weight: bold;">gltMakeCylinder</span>(GLTriangleBatch&amp; cylinderBatch, <span style="color: #00ffff; font-weight: bold;">GLfloat</span> <span style="color: #ffd700; font-style: italic;">baseRadius</span>, <span style="color: #00ffff; font-weight: bold;">GLint</span> <span style="color: #ffd700; font-style: italic;">topRadius</span>, <span style="color: #00ffff; font-weight: bold;">GLfloat</span> <span style="color: #ffd700; font-style: italic;">fLength</span>, <span style="color: #00ffff; font-weight: bold;">GLint</span> <span style="color: #ffd700; font-style: italic;">numSlices</span>, <span style="color: #00ffff; font-weight: bold;">GLint</span> <span style="color: #ffd700; font-style: italic;">numStacks</span>);   
</pre>


<p>
   圆柱体从0开始向z轴正方向延伸，我们既可以指定底部半径，也可以设置顶部半径。参数 numSlices 代表围绕z轴的三角形对的数量，而参数 numStacks 则代表从底部堆叠到顶部圆环的数量。
</p>

<div class="figure">
<p><img src="./images/opengl_fig14.png"  alt="./images/opengl_fig14.png" /></p>
<p>一个两端半径相等的圆柱体</p>
</div>


<div class="figure">
<p><img src="./images/opengl_fig15.png"  alt="./images/opengl_fig15.png" /></p>
<p>一个一端半径设置为0的圆柱体，也就是一个圆锥</p>
</div>


</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> 创建一个圆盘</h2>
<div class="outline-text-2" id="text-6">



<p>
   圆盘是通过分解成若干片段的三角形带绘制而成的。我们可以指定一个内部半径来创建一个类似垫圈的形状，也可以让这个值保持为0来创建一个实心圆盘。 <code>gltMakeDisk</code> 用圆盘形状来填充一个 GLTriangleBatch。
</p>



<pre class="src src-c"><span style="color: #00ffff; font-weight: bold;">void</span> <span style="color: #ffd700; font-weight: bold;">gltMakeDisk</span>(GLTriangleBatch&amp; diskBatch, <span style="color: #00ffff; font-weight: bold;">GLfloat</span> <span style="color: #ffd700; font-style: italic;">innerRadius</span>, <span style="color: #00ffff; font-weight: bold;">GLint</span> <span style="color: #ffd700; font-style: italic;">outerRadius</span>, <span style="color: #00ffff; font-weight: bold;">GLint</span> <span style="color: #ffd700; font-style: italic;">nSlices</span>, <span style="color: #00ffff; font-weight: bold;">GLint</span> <span style="color: #ffd700; font-style: italic;">nStacks</span>);   
</pre>



<div class="figure">
<p><img src="./images/opengl_fig16.png"  alt="./images/opengl_fig16.png" /></p>
<p>设置了内部和外部半径的圆盘</p>
</div>

</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2012-10-18 14:49:09 CST</p>
<p class="author">Author: Joseph Pan</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
